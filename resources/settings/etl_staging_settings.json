{
	"work_queue": {
		"name": "ekyle-etl",
		"$ref": "file://~/private.json#aws_credentials"
	},
	"param": {
		"threads": 4,
		"wait_forever": true,
		"keep_unknown_on_queue": true
	},
	"constants": {
		"pyLibrary.env.http.default_headers": {
			"From": "https://wiki.mozilla.org/Auto-tools/Projects/ActiveData"
		},
		"pyLibrary.env.big_data.MAX_STRING_SIZE": 10000000
	},
	"workers": [
		{
			"name": "pulse2es",
			"source": {
				"$ref": "file://~/private.json#aws_credentials",
				"bucket": "ekyle-pulse-logger"
			},
			"destination":	{
				"use_daily": false,
				"host" : "http://172.31.0.146",
				"port" : 9200,
				"index" : "pulse",
				"type" : "pulse_log",
				"timeout" : 300,
				"schema" : {"$ref": "//../schema/pulse_logs.json"},
				"debug": false,
				"limit_replicas": true
			},
			"transformer": "testlog_etl.transforms.pulse_block_to_es.process_pulse_block_to_es",
			"type": "join"
		},
		{
			"name": "pulse2talos",
			"source": {
				"$ref": "file://~/private.json#aws_credentials",
				"bucket": "ekyle-pulse-logger"
			},
			"destination": {
				"$ref": "file://~/private.json#aws_credentials",
				"bucket": "ekyle-talos",
				"public": true
			},
			"transformer": "testlog_etl.transforms.pulse_block_to_talos_logs.process_talos",
			"type": "join"
		},
		{
			"name": "pulse2test_result",
			"source": {
				"$ref": "file://~/private.json#aws_credentials",
				"bucket": "ekyle-pulse-logger"
			},
			"destination": {
				"$ref": "file://~/private.json#aws_credentials",
				"bucket": "ekyle-test-result"
			},
			"transformer": "testlog_etl.transforms.pulse_block_to_test_result_logs.process_talos",
			"type": "join"
		},
//		{
//			"name":"load es",
//			"source": {
//				"$ref": "file://~/private.json#aws_credentials",
//				"bucket": "ekyle-test-result"
//			},
//			"destination": {
//				"use_daily": true,
//				"host": "http://172.31.0.146",
//				"port": 9200,
//				"index": "unittest",
//				"type": "test_result",
//				"timeout": 300,
//				"schema": {
//					"$ref": "//../schema/test_results.json"
//				},
//				"debug": true,
//				"limit_replicas": true
//			},
//			"transformer": "testlog_etl.transforms.test_result_to_sink.process_test_result",
//			"type": "join"
//
//		},
		{
			"name":"load redshift",
			"source": {
				"$ref": "file://~/private.json#aws_credentials",
				"bucket": "ekyle-test-result"
			},
			"destination": {
				"type": "redshift",
				"host": "ekyle-redshift-test.cishavsxiep4.us-west-2.redshift.amazonaws.com",
				"port": 5439,
				"database": "unittest",
				"table": "test_results",
				"$ref": "file://~/private.json#redshift",
				"mapping": {
					"$ref": "//../schema/redshift.json"
				},
				"timeout": 300,
				"debug": true,
				"source":{
					"$ref":"#...source"
				},
				"meta": {
					"bucket": "ekyle-metadata",
					"jsonspath": "push_to_redshift",
					"$ref": "file://~/private.json#aws_credentials"
				}
			},
			"transformer": "testlog_etl.transforms.test_result_to_redshift.process_test_result",
			"type": "join",
			"transform_type": "bulk"  //AVOID etl DEALING WITH INDIVIDUAL KEYS
		}
	],
	"debug": {
		"trace": true,
//		"cprofile": {
//			"enabled": true,
//			"filename": "./results/profile.tab"
//		},
		"log": [
			{
				"log_type": "console"
			},
			{
				"log_type": "elasticsearch",
				"host": "http://172.31.0.146",
				"index": "debug",
				"type": "unittest_etl"
			},
			{
				"log_type": "email",
				"from_address": "klahnakoski@mozilla.com",
				"to_address": "klahnakoski@mozilla.com",
				"subject": "[Developer Alert][STAGING] Problem in ETL",
				"$ref":"file://~/private.json#email"

			}
		]
	}
}
